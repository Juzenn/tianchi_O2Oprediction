setwd('C:\\Users\\yanpan\\Desktop')
data<-read.table('trainoff_result_logistic.txt',header=T,sep=',')
y<-(data$X_y>0)*(data$X2>0)
data$X_y<-y
data1<-data[data$X_nfindr==0,]
data2<-data1[data1$X4>0,]
summary(lm(data2$X_y~data2$rate_level+data2$X4))
glmlogit0<-glm(data2$X_y~log(data2$rate_level+65)+log(data2$X4+0.4),family=binomial(link="logit"))
summary(glmlogit0)
glmlogit0<-glm(data2$X_y~data2$rate_level+log(data2$X4+0.4),family=binomial(link="logit"))
summary(glmlogit0)
glmlogit0<-glm(data2$X_y~data2$rate_level+data2$X4,family=binomial(link="logit"))
summary(glmlogit0)
glmlogit0<-glm(data2$X_y~log(data2$rate_level+65)+data2$X4,family=binomial(link="logit"))
summary(glmlogit0)
rl<-1/(data2$rate_level+30)
di<-1/(data2$X4+0.4)
glmlogit0<-glm(data2$X_y~rl+di+,family=binomial(link="logit"))
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
rl<-data2$rate_level
di<-1/(data2$X4+0.4)
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
rl<-1/(data2$rate_level+30)
di<-data2$X4
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
rl<-log(data2$rate_level+65)
di<-data2$X4
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
library(ROCR)
couponauc<-function(coupon,data0){
auc0<-NULL
for(i in 1:length(coupon)){ # 1:1000
index1<-data0$X2==coupon[i]
yp1<-data0$yp[index1]
y1<-data0$X_y[index1]
if(sum(y1==0)==0){
y1<-c(y1,0)
yp1<-c(yp1,0)
}
if(sum(y1==1)==0){
y1<-c(y1,1)
yp1<-c(yp1,1)
}
pred <- prediction(yp1,y1)
auc <- performance(pred,'auc')
auc <- unlist(slot(auc,'y.values'))
auc0<-c(auc0,auc)
}
auc0
}
X1<-cbind(1,rl,di)
yp<-1/(1+exp(-X1%*%glmlogit0$coefficients))
data20<-cbind(yp,data2)
coupon<-unique(data20$X2)
mean(couponauc(coupon, data20))
data$X_y<-y
data1<-data[data$X_nfindr==0,]
data2<-data1[data1$X4>0,]
#summary(lm(data2$X_y~data2$rate_level+data2$X4))
rl<-data2$rate_level
di<-data2$X4
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
#############
X1<-cbind(1,rl,di)
yp<-1/(1+exp(-X1%*%glmlogit0$coefficients))
data20<-cbind(yp,data2)
coupon<-unique(data20$X2)
mean(couponauc(coupon, data20))
rl<-data2$rate_level
di<-data2$X4
glmlogit1<-glm(data2$X_y~rl*di,family=binomial(link="logit"))
summary(glmlogit1)
glmlogit1<-glm(data2$X_y~(rl*di),family=binomial(link="logit"))
summary(glmlogit1)
rl*di
X1<-cbind(1,rl,di,rl*di)
yp<-1/(1+exp(-X1%*%glmlogit1$coefficients))
data$X_y<-y
data1<-data[data$X_nfindr==0,]
data2<-data1[data1$X4>0,]
rl<-data2$rate_level
di<-data2$X4
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
glmlogit1<-glm(data2$X_y~(rl*di),family=binomial(link="logit"))
summary(glmlogit1)
X1<-cbind(1,rl,di,rl*di)
yp<-1/(1+exp(-X1%*%glmlogit1$coefficients))
data20<-cbind(yp,data2)
coupon<-unique(data20$X2)
mean(couponauc(coupon, data20))
uu<-(rl*di)
glmlogit1<-glm(data2$X_y~uu,family=binomial(link="logit"))
summary(glmlogit1)
rl<-log(log(log(log(data2$rate_level+60))))
di<-data2$X4
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
di<-log(log(log(log(data2$X4+60)
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
rl<-log(log(log(log(data2$rate_level+60))))
di<-log(log(log(log(data2$X4+60))))
glmlogit0<-glm(data2$X_y~rl+di,family=binomial(link="logit"))
summary(glmlogit0)
rl<-data2$rate_level
di<-data2$X4
uu<-(rl<=30)*(dl<=1)
rl<-data2$rate_level
di<-data2$X4
uu<-(rl<=30)*(di<=1)
glmlogit0<-glm(data2$X_y~uu,family=binomial(link="logit"))
summary(glmlogit0)
uu<-(rl<=30)*(di<=0.5)
glmlogit0<-glm(data2$X_y~uu,family=binomial(link="logit"))
summary(glmlogit0)
uu<-(rl<=30)*(di<=2)
glmlogit0<-glm(data2$X_y~uu,family=binomial(link="logit"))
summary(glmlogit0)
uu<-(rl<=30)*(di<=3)
glmlogit0<-glm(data2$X_y~uu,family=binomial(link="logit"))
summary(glmlogit0)
uu<-(rl<=30)*(di<=4)
glmlogit0<-glm(data2$X_y~uu,family=binomial(link="logit"))
summary(glmlogit0)
uu<-(rl<=30)*(di<=10)
glmlogit0<-glm(data2$X_y~uu,family=binomial(link="logit"))
summary(glmlogit0)
rl<-data2$rate_level^0.5
di<-data2$X4^0.5
glmlogit0<-glm(data2$X_y~rl*dl,family=binomial(link="logit"))
summary(glmlogit0)
glmlogit0<-glm(data2$X_y~rl*di,family=binomial(link="logit"))
summary(glmlogit0)
summary(lm(data2$X_y~rl+di))
summary(lm(data2$X_y~rl*di))
uu<-rl*di
summary(lm(data2$X_y~uu))
glmlogit0<-glm(data2$X_y~data2$rate_level+data2$X4,family=binomial(link="logit"))
summary(glmlogit0)
X1<-cbind(1,data2$rate_level,data2$X4)
yp<-1/(1+exp(-X1%*%glmlogit0$coefficients))
data20<-cbind(yp,data2)
datatest<-read.table('testoff_result_logistic.txt',header=T,sep=',')
Xtest<-cbind(1,log(datatest$rate_level+65),log(datatest$X4+0.4))
ytestp<-1/(1+exp(-Xtest%*%glmlogit0$coefficients))
datatestpred1<-data.frame(User_id=datatest$X0,Coupon_id=datatest$X2,Date_received=datatest$X5,Probability=ytestp)
write.csv(datatestpred1,'datatestpred1.csv',row.names =F)
sum(datatestpred1-datatestpred)
dataset<-data.frame(data$X_y,data$X4,data$rate_level)
View(dataset)
View(datatest)
aggregate(dataset,by=list(X4,rate_level))
aggregate(dataset,by=list(X4,rate_level),FUN='mean')
aggregate(X_y~X4+rate_level,data=dataset,FUN='mean')
dataset
dataset<-data.frame(y=data$X_y,dist=data$X4,ratelevel=data$rate_level)
aggregate(X_y~X4+rate_level,data=dataset,FUN='mean')
aggregate(y~dist+rate_level,data=dataset,FUN='mean')
aggregate(y~dist+ratelevel,data=dataset,FUN='mean')
datasetag<-aggregate(y~dist+ratelevel,data=dataset,FUN='mean')
View(datasetag)
summary(lm(datasetag$y~datasetag$dist+datasetag$ratelevel))
summary(lm(datasetag$y~log(datasetag$dist+0.4)+log(datasetag$ratelevel+65)))
setwd('E:\\OneDrive\\Documents\\_Sufelearning\\Bigdata\\tianchi_O2Oprediction')
dataols<-read.table('aaa.txt',header=T,sep = ',')
dist<-log(dataols$distance+0.37598)
rate<-log(dataols$rate_level+13.06200)
y<-dataols$pab
lmsummary<-summary(lm(log(y)~cbind(dist,rate)))
lmsummary
dataset<-data.frame(distance=data$X4,rate_level=data$rate_level,pab=data$X_y)
datasetag<-aggregate(pab~distance+rate_level,data=dataset,FUN='mean')
summary(lm(datasetag$pab~log(datasetag$distance+0.37598)+log(datasetag$rate_level+13.06200)))
merge(dataset,dataols)
dataols
dataset
merge(datasetag,dataols)
dataset<-data.frame(distance=data$X4,rate_level=data$rate_level,y=data$X_y)
datasetag<-aggregate(y~distance+rate_level,data=dataset,FUN='mean')
summary(lm(datasetag$y~log(datasetag$distance+0.37598)+log(datasetag$rate_level+13.06200)))
merge(datasetag,dataols)
